<!-- views/admin_orders.ejs -->
<div class="row mb-4">
    <div class="col-12">
        <h2 class="mb-3">ðŸ“¦ Order Management</h2>
        
        <!-- Filter Form -->
        <div class="card bg-light mb-3">
            <div class="card-body">
                <form action="/admin/orders" method="GET" class="row g-3 align-items-center">
                    <div class="col-auto">
                        <label class="col-form-label fw-bold">Filter Status:</label>
                    </div>
                    <div class="col-auto">
                        <select name="status" class="form-select">
                            <option value="">-- All Statuses --</option>
                            <option value="PENDING" <%= status === 'PENDING' ? 'selected' : '' %>>PENDING</option>
                            <option value="CONFIRMED" <%= status === 'CONFIRMED' ? 'selected' : '' %>>CONFIRMED</option>
                            <option value="SHIPPING" <%= status === 'SHIPPING' ? 'selected' : '' %>>SHIPPING</option>
                            <option value="COMPLETED" <%= status === 'COMPLETED' ? 'selected' : '' %>>COMPLETED</option>
                            <option value="CANCELLED" <%= status === 'CANCELLED' ? 'selected' : '' %>>CANCELLED</option>
                            <option value="RETURNED" <%= status === 'RETURNED' ? 'selected' : '' %>>RETURNED</option>
                        </select>
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-primary">Filter</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Orders Table -->
        <div class="card">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>User Email</th>
                            <th>Total Amount</th>
                            <th>Final Amount</th>
                            <th>Status</th>
                            <th>Payment</th>
                            <th>Date</th>
                            <th>Action (Update Status)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (orders.length === 0) { %>
                            <tr><td colspan="8" class="text-center py-3">No orders found.</td></tr>
                        <% } %>

                        <% orders.forEach(o => { %>
                            <tr>
                                <td>#<%= o.order_id %></td>
                                <td><%= o.user_email %></td>
                                <td><%= o.total_amount.toLocaleString() %></td>
                                <td class="fw-bold text-success"><%= o.final_amount.toLocaleString() %></td>
                                <td>
                                    <span class="badge bg-<%= 
                                        o.status === 'PENDING' ? 'warning' : 
                                        (o.status === 'COMPLETED' ? 'success' : 
                                        (o.status === 'CANCELLED' ? 'danger' : 'info')) 
                                    %>">
                                        <%= o.status %>
                                    </span>
                                </td>
                                <td><%= o.payment_method %></td>
                                <td><%= new Date(o.created_at).toLocaleDateString() %></td>
                                <td>
                                    <form action="/admin/orders/update" method="POST" class="d-flex gap-2">
                                        <input type="hidden" name="order_id" value="<%= o.order_id %>">
                                        <select name="new_status" class="form-select form-select-sm" style="width: 130px;">
                                            <option value="CONFIRMED">Confirm</option>
                                            <option value="SHIPPING">Ship</option>
                                            <option value="COMPLETED">Complete</option>
                                            <option value="CANCELLED">Cancel</option>
                                            <option value="RETURNED">Return</option>
                                        </select>
                                        <button class="btn btn-sm btn-outline-dark">Update</button>
                                    </form>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
